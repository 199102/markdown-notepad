/*! markdown-notepad v0.1.0 2016-04-27 */
!function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery","showdown"],a):"object"==typeof exports?a(require("jquery"),require("showdown")):window.jQuery&&a(window.jQuery,showdown)}(function(a,b){var c=function(c,d){var e=this;e._el=c,e._opt=d;var f=new b.Converter({strikethrough:!0,tables:!0});e._adapter=a("textarea",c).ntadapter({data:a.proxy(e._data,e)}).markdown({language:d.lang,parser:function(a){return f.makeHtml(a)},onChange:a.proxy(e._change,e),additionalButtons:[[{name:"groupCustom",data:[{name:"cmdLocalImg",toggle:!0,title:d.lblLocalimg||"Local Image",icon:"glyphicon glyphicon-picture",btnText:d.lblLocalimg||"Local",callback:function(){a(e._el).notes("openLocal",function(a,b,c){var d=c[b],f=d.name;e.insertImage(f,a)})}}]}]]})[0],a(c).notes({adapter:e._adapter,suffix:"md",mime:"text/markdown"})};c.prototype={constructor:c,_change:function(){var b=this,c=a(b._adapter);c.trigger("edit.ntadapter",c.data("markdown").getContent())},_data:function(b){var c=this,d=a(c._adapter).data("markdown");return b?(d.setContent(b.d||""),b.d=d.getContent(),b.readOnly?(d.hidePreview(),d.showPreview()):d.$isPreview&&b.d&&!b.unsaved?(d.hidePreview(),d.showPreview()):d.hidePreview(),void 0):d.getContent()},preview:function(){var b=this,c=a(b._adapter).data("markdown"),d=c.$isPreview;d?c.hidePreview():c.showPreview()},save2LocalStore:function(){var b=this;a(b._el).notes("save2LocalStore")},insertImage:function(b,c){var d,e,f=this,g=a(f._adapter).data("markdown"),h=g.getSelection();d="!["+b+"]("+c+")",g.replaceSelection(d),e=h.start,g.setSelection(e,e+d.length)}},a.fn.mdnotepad=function(b){var d=arguments;return this.each(function(){var e=a(this),f=e.data("mdnotepad"),g="object"==typeof b?b:{};f||"string"==typeof b?"string"==typeof b&&f[b].apply(f,Array.prototype.slice.call(d,1)):e.data("mdnotepad",new c(this,a.extend(g,e.data())))})},a(document).ready(function(){var b=a(".notes").mdnotepad();if(a(document).on("click","a",function(c){var d=a(c.currentTarget)[0],e=d.href,f=d.pathname.split("/").pop(),g=f.lastIndexOf("."),h=-1!==g?f.substring(g+1).toLowerCase():null;!h||"md"!==h&&"txt"!==h?d.pathname!==window.location.pathname&&"_self"!==d.target&&(d.target="_blank"):(b.notes("openRemote",e),c.preventDefault())}),window.localStorage){var c="0.1.0";window.localStorage.getItem("__ver")!==c&&(window.localStorage.setItem("__ver",c),a("a[name=welcome]",b).click())}a(window).bind("beforeunload",function(){return window.localStorage?void a(".notes").mdnotepad("save2LocalStore"):"Do you really want to close?"}).on("keydown",function(b){switch(b.which){case 116:a(".notes").mdnotepad("preview"),b.preventDefault(),b.stopPropagation();break;default:a(".notes").notes("hotkey",b)}}).on("paste",function(b){var c=b.originalEvent,d=(c.clipboardData||c.originalEvent.clipboardData).items,e=null;if(d){for(var f=0;f<d.length;f++)0===d[f].type.indexOf("image")&&(e=d[f].getAsFile());if(null!==e){var g=new FileReader;g.onload=function(b){a(".notes").mdnotepad("insertImage","Pasted image",b.target.result)},g.readAsDataURL(e)}}})})});